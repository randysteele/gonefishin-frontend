{"ast":null,"code":"/*! firebase-admin v9.2.0 */\n\"use strict\";\n/*!\n * Copyright 2020 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Model = exports.MachineLearning = void 0;\n\nvar machine_learning_api_client_1 = require(\"./machine-learning-api-client\");\n\nvar error_1 = require(\"../utils/error\");\n\nvar validator = require(\"../utils/validator\");\n\nvar machine_learning_utils_1 = require(\"./machine-learning-utils\");\n\nvar deep_copy_1 = require(\"../utils/deep-copy\");\n\nvar utils = require(\"../utils\");\n/**\n * Internals of an ML instance.\n */\n\n\nvar MachineLearningInternals =\n/** @class */\nfunction () {\n  function MachineLearningInternals() {}\n  /**\n   * Deletes the service and its associated resources.\n   *\n   * @return {Promise<void>} An empty Promise that will be resolved when the\n   *     service is deleted.\n   */\n\n\n  MachineLearningInternals.prototype.delete = function () {\n    // There are no resources to clean up.\n    return Promise.resolve();\n  };\n\n  return MachineLearningInternals;\n}();\n/**\n * The Firebase Machine Learning class\n */\n\n\nvar MachineLearning =\n/** @class */\nfunction () {\n  /**\n   * @param {FirebaseApp} app The app for this ML service.\n   * @constructor\n   */\n  function MachineLearning(app) {\n    this.INTERNAL = new MachineLearningInternals();\n\n    if (!validator.isNonNullObject(app) || !('options' in app)) {\n      throw new error_1.FirebaseError({\n        code: 'machine-learning/invalid-argument',\n        message: 'First argument passed to admin.machineLearning() must be a ' + 'valid Firebase app instance.'\n      });\n    }\n\n    this.appInternal = app;\n    this.client = new machine_learning_api_client_1.MachineLearningApiClient(app);\n  }\n\n  Object.defineProperty(MachineLearning.prototype, \"app\", {\n    /**\n     * Returns the app associated with this ML instance.\n     *\n     * @return {FirebaseApp} The app associated with this ML instance.\n     */\n    get: function get() {\n      return this.appInternal;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  /**\n   * Creates a model in Firebase ML.\n   *\n   * @param {ModelOptions} model The model to create.\n   *\n   * @return {Promise<Model>} A Promise fulfilled with the created model.\n   */\n\n  MachineLearning.prototype.createModel = function (model) {\n    var _this = this;\n\n    return this.signUrlIfPresent(model).then(function (modelContent) {\n      return _this.client.createModel(modelContent);\n    }).then(function (operation) {\n      return _this.client.handleOperation(operation);\n    }).then(function (modelResponse) {\n      return new Model(modelResponse, _this.client);\n    });\n  };\n  /**\n   * Updates a model in Firebase ML.\n   *\n   * @param {string} modelId The id of the model to update.\n   * @param {ModelOptions} model The model fields to update.\n   *\n   * @return {Promise<Model>} A Promise fulfilled with the updated model.\n   */\n\n\n  MachineLearning.prototype.updateModel = function (modelId, model) {\n    var _this = this;\n\n    var updateMask = utils.generateUpdateMask(model);\n    return this.signUrlIfPresent(model).then(function (modelContent) {\n      return _this.client.updateModel(modelId, modelContent, updateMask);\n    }).then(function (operation) {\n      return _this.client.handleOperation(operation);\n    }).then(function (modelResponse) {\n      return new Model(modelResponse, _this.client);\n    });\n  };\n  /**\n   * Publishes a model in Firebase ML.\n   *\n   * @param {string} modelId The id of the model to publish.\n   *\n   * @return {Promise<Model>} A Promise fulfilled with the published model.\n   */\n\n\n  MachineLearning.prototype.publishModel = function (modelId) {\n    return this.setPublishStatus(modelId, true);\n  };\n  /**\n   * Unpublishes a model in Firebase ML.\n   *\n   * @param {string} modelId The id of the model to unpublish.\n   *\n   * @return {Promise<Model>} A Promise fulfilled with the unpublished model.\n   */\n\n\n  MachineLearning.prototype.unpublishModel = function (modelId) {\n    return this.setPublishStatus(modelId, false);\n  };\n  /**\n   * Gets a model from Firebase ML.\n   *\n   * @param {string} modelId The id of the model to get.\n   *\n   * @return {Promise<Model>} A Promise fulfilled with the unpublished model.\n   */\n\n\n  MachineLearning.prototype.getModel = function (modelId) {\n    var _this = this;\n\n    return this.client.getModel(modelId).then(function (modelResponse) {\n      return new Model(modelResponse, _this.client);\n    });\n  };\n  /**\n   * Lists models from Firebase ML.\n   *\n   * @param {ListModelsOptions} options The listing options.\n   *\n   * @return {Promise<{models: Model[], pageToken?: string}>} A promise that\n   *     resolves with the current (filtered) list of models and the next page\n   *     token. For the last page, an empty list of models and no page token are\n   *     returned.\n   */\n\n\n  MachineLearning.prototype.listModels = function (options) {\n    var _this = this;\n\n    if (options === void 0) {\n      options = {};\n    }\n\n    return this.client.listModels(options).then(function (resp) {\n      if (!validator.isNonNullObject(resp)) {\n        throw new machine_learning_utils_1.FirebaseMachineLearningError('invalid-argument', \"Invalid ListModels response: \" + JSON.stringify(resp));\n      }\n\n      var models = [];\n\n      if (resp.models) {\n        models = resp.models.map(function (rs) {\n          return new Model(rs, _this.client);\n        });\n      }\n\n      var result = {\n        models: models\n      };\n\n      if (resp.nextPageToken) {\n        result.pageToken = resp.nextPageToken;\n      }\n\n      return result;\n    });\n  };\n  /**\n   * Deletes a model from Firebase ML.\n   *\n   * @param {string} modelId The id of the model to delete.\n   */\n\n\n  MachineLearning.prototype.deleteModel = function (modelId) {\n    return this.client.deleteModel(modelId);\n  };\n\n  MachineLearning.prototype.setPublishStatus = function (modelId, publish) {\n    var _this = this;\n\n    var updateMask = ['state.published'];\n    var options = {\n      state: {\n        published: publish\n      }\n    };\n    return this.client.updateModel(modelId, options, updateMask).then(function (operation) {\n      return _this.client.handleOperation(operation);\n    }).then(function (modelResponse) {\n      return new Model(modelResponse, _this.client);\n    });\n  };\n\n  MachineLearning.prototype.signUrlIfPresent = function (options) {\n    var modelOptions = deep_copy_1.deepCopy(options);\n\n    if (machine_learning_api_client_1.isGcsTfliteModelOptions(modelOptions)) {\n      return this.signUrl(modelOptions.tfliteModel.gcsTfliteUri).then(function (uri) {\n        modelOptions.tfliteModel.gcsTfliteUri = uri;\n        return modelOptions;\n      }).catch(function (err) {\n        throw new machine_learning_utils_1.FirebaseMachineLearningError('internal-error', \"Error during signing upload url: \" + err.message);\n      });\n    }\n\n    return Promise.resolve(modelOptions);\n  };\n\n  MachineLearning.prototype.signUrl = function (unsignedUrl) {\n    var MINUTES_IN_MILLIS = 60 * 1000;\n    var URL_VALID_DURATION = 10 * MINUTES_IN_MILLIS;\n    var gcsRegex = /^gs:\\/\\/([a-z0-9_.-]{3,63})\\/(.+)$/;\n    var matches = gcsRegex.exec(unsignedUrl);\n\n    if (!matches) {\n      throw new machine_learning_utils_1.FirebaseMachineLearningError('invalid-argument', \"Invalid unsigned url: \" + unsignedUrl);\n    }\n\n    var bucketName = matches[1];\n    var blobName = matches[2];\n    var bucket = this.appInternal.storage().bucket(bucketName);\n    var blob = bucket.file(blobName);\n    return blob.getSignedUrl({\n      action: 'read',\n      expires: Date.now() + URL_VALID_DURATION\n    }).then(function (signUrl) {\n      return signUrl[0];\n    });\n  };\n\n  return MachineLearning;\n}();\n\nexports.MachineLearning = MachineLearning;\n/**\n * A Firebase ML Model output object.\n */\n\nvar Model =\n/** @class */\nfunction () {\n  function Model(model, client) {\n    this.model = Model.validateAndClone(model);\n    this.client = client;\n  }\n\n  Object.defineProperty(Model.prototype, \"modelId\", {\n    get: function get() {\n      return extractModelId(this.model.name);\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Model.prototype, \"displayName\", {\n    get: function get() {\n      return this.model.displayName;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Model.prototype, \"tags\", {\n    get: function get() {\n      return this.model.tags || [];\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Model.prototype, \"createTime\", {\n    get: function get() {\n      return new Date(this.model.createTime).toUTCString();\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Model.prototype, \"updateTime\", {\n    get: function get() {\n      return new Date(this.model.updateTime).toUTCString();\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Model.prototype, \"validationError\", {\n    get: function get() {\n      var _a, _b;\n\n      return (_b = (_a = this.model.state) === null || _a === void 0 ? void 0 : _a.validationError) === null || _b === void 0 ? void 0 : _b.message;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Model.prototype, \"published\", {\n    get: function get() {\n      var _a;\n\n      return ((_a = this.model.state) === null || _a === void 0 ? void 0 : _a.published) || false;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Model.prototype, \"etag\", {\n    get: function get() {\n      return this.model.etag;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Model.prototype, \"modelHash\", {\n    get: function get() {\n      return this.model.modelHash;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Model.prototype, \"tfliteModel\", {\n    get: function get() {\n      // Make a copy so people can't directly modify the private this.model object.\n      return deep_copy_1.deepCopy(this.model.tfliteModel);\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Model.prototype, \"locked\", {\n    /**\n     * Locked indicates if there are active long running operations on the model.\n     * Models may not be modified when they are locked.\n     */\n    get: function get() {\n      var _a, _b;\n\n      return ((_b = (_a = this.model.activeOperations) === null || _a === void 0 ? void 0 : _a.length) !== null && _b !== void 0 ? _b : 0) > 0;\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  Model.prototype.toJSON = function () {\n    // We can't just return this.model because it has extra fields and\n    // different formats etc. So we build the expected model object.\n    var jsonModel = {\n      modelId: this.modelId,\n      displayName: this.displayName,\n      tags: this.tags,\n      createTime: this.createTime,\n      updateTime: this.updateTime,\n      published: this.published,\n      etag: this.etag,\n      locked: this.locked\n    }; // Also add possibly undefined fields if they exist.\n\n    if (this.validationError) {\n      jsonModel['validationError'] = this.validationError;\n    }\n\n    if (this.modelHash) {\n      jsonModel['modelHash'] = this.modelHash;\n    }\n\n    if (this.tfliteModel) {\n      jsonModel['tfliteModel'] = this.tfliteModel;\n    }\n\n    return jsonModel;\n  };\n  /**\n   * Wait for the active operations on the model to complete.\n   * @param maxTimeMillis The number of milliseconds to wait for the model to be unlocked. If unspecified,\n   *     a default will be used.\n   */\n\n\n  Model.prototype.waitForUnlocked = function (maxTimeMillis) {\n    var _this = this;\n\n    var _a, _b;\n\n    if (((_b = (_a = this.model.activeOperations) === null || _a === void 0 ? void 0 : _a.length) !== null && _b !== void 0 ? _b : 0) > 0) {\n      // The client will always be defined on Models that have activeOperations\n      // because models with active operations came back from the server and\n      // were constructed with a non-empty client.\n      return this.client.handleOperation(this.model.activeOperations[0], {\n        wait: true,\n        maxTimeMillis: maxTimeMillis\n      }).then(function (modelResponse) {\n        _this.model = Model.validateAndClone(modelResponse);\n      });\n    }\n\n    return Promise.resolve();\n  };\n\n  Model.validateAndClone = function (model) {\n    if (!validator.isNonNullObject(model) || !validator.isNonEmptyString(model.name) || !validator.isNonEmptyString(model.createTime) || !validator.isNonEmptyString(model.updateTime) || !validator.isNonEmptyString(model.displayName) || !validator.isNonEmptyString(model.etag)) {\n      throw new machine_learning_utils_1.FirebaseMachineLearningError('invalid-server-response', \"Invalid Model response: \" + JSON.stringify(model));\n    }\n\n    var tmpModel = deep_copy_1.deepCopy(model); // If tflite Model is specified, it must have a source consisting of\n    // oneof {gcsTfliteUri, automlModel}\n\n    if (model.tfliteModel && !validator.isNonEmptyString(model.tfliteModel.gcsTfliteUri) && !validator.isNonEmptyString(model.tfliteModel.automlModel)) {\n      // If we have some other source, ignore the whole tfliteModel.\n      delete tmpModel.tfliteModel;\n    } // Remove '@type' field. We don't need it.\n\n\n    if (tmpModel[\"@type\"]) {\n      delete tmpModel[\"@type\"];\n    }\n\n    return tmpModel;\n  };\n\n  return Model;\n}();\n\nexports.Model = Model;\n\nfunction extractModelId(resourceName) {\n  return resourceName.split('/').pop();\n}","map":{"version":3,"sources":["/Users/randysteele/gone-fishin/gone-fishin-frontend/node_modules/firebase-admin/lib/machine-learning/machine-learning.js"],"names":["Object","defineProperty","exports","value","Model","MachineLearning","machine_learning_api_client_1","require","error_1","validator","machine_learning_utils_1","deep_copy_1","utils","MachineLearningInternals","prototype","delete","Promise","resolve","app","INTERNAL","isNonNullObject","FirebaseError","code","message","appInternal","client","MachineLearningApiClient","get","enumerable","configurable","createModel","model","_this","signUrlIfPresent","then","modelContent","operation","handleOperation","modelResponse","updateModel","modelId","updateMask","generateUpdateMask","publishModel","setPublishStatus","unpublishModel","getModel","listModels","options","resp","FirebaseMachineLearningError","JSON","stringify","models","map","rs","result","nextPageToken","pageToken","deleteModel","publish","state","published","modelOptions","deepCopy","isGcsTfliteModelOptions","signUrl","tfliteModel","gcsTfliteUri","uri","catch","err","unsignedUrl","MINUTES_IN_MILLIS","URL_VALID_DURATION","gcsRegex","matches","exec","bucketName","blobName","bucket","storage","blob","file","getSignedUrl","action","expires","Date","now","validateAndClone","extractModelId","name","displayName","tags","createTime","toUTCString","updateTime","_a","_b","validationError","etag","modelHash","activeOperations","length","toJSON","jsonModel","locked","waitForUnlocked","maxTimeMillis","wait","isNonEmptyString","tmpModel","automlModel","resourceName","split","pop"],"mappings":"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","sourcesContent":["/*! firebase-admin v9.2.0 */\n\"use strict\";\n/*!\n * Copyright 2020 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Model = exports.MachineLearning = void 0;\nvar machine_learning_api_client_1 = require(\"./machine-learning-api-client\");\nvar error_1 = require(\"../utils/error\");\nvar validator = require(\"../utils/validator\");\nvar machine_learning_utils_1 = require(\"./machine-learning-utils\");\nvar deep_copy_1 = require(\"../utils/deep-copy\");\nvar utils = require(\"../utils\");\n/**\n * Internals of an ML instance.\n */\nvar MachineLearningInternals = /** @class */ (function () {\n    function MachineLearningInternals() {\n    }\n    /**\n     * Deletes the service and its associated resources.\n     *\n     * @return {Promise<void>} An empty Promise that will be resolved when the\n     *     service is deleted.\n     */\n    MachineLearningInternals.prototype.delete = function () {\n        // There are no resources to clean up.\n        return Promise.resolve();\n    };\n    return MachineLearningInternals;\n}());\n/**\n * The Firebase Machine Learning class\n */\nvar MachineLearning = /** @class */ (function () {\n    /**\n     * @param {FirebaseApp} app The app for this ML service.\n     * @constructor\n     */\n    function MachineLearning(app) {\n        this.INTERNAL = new MachineLearningInternals();\n        if (!validator.isNonNullObject(app) || !('options' in app)) {\n            throw new error_1.FirebaseError({\n                code: 'machine-learning/invalid-argument',\n                message: 'First argument passed to admin.machineLearning() must be a ' +\n                    'valid Firebase app instance.',\n            });\n        }\n        this.appInternal = app;\n        this.client = new machine_learning_api_client_1.MachineLearningApiClient(app);\n    }\n    Object.defineProperty(MachineLearning.prototype, \"app\", {\n        /**\n         * Returns the app associated with this ML instance.\n         *\n         * @return {FirebaseApp} The app associated with this ML instance.\n         */\n        get: function () {\n            return this.appInternal;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * Creates a model in Firebase ML.\n     *\n     * @param {ModelOptions} model The model to create.\n     *\n     * @return {Promise<Model>} A Promise fulfilled with the created model.\n     */\n    MachineLearning.prototype.createModel = function (model) {\n        var _this = this;\n        return this.signUrlIfPresent(model)\n            .then(function (modelContent) { return _this.client.createModel(modelContent); })\n            .then(function (operation) { return _this.client.handleOperation(operation); })\n            .then(function (modelResponse) { return new Model(modelResponse, _this.client); });\n    };\n    /**\n     * Updates a model in Firebase ML.\n     *\n     * @param {string} modelId The id of the model to update.\n     * @param {ModelOptions} model The model fields to update.\n     *\n     * @return {Promise<Model>} A Promise fulfilled with the updated model.\n     */\n    MachineLearning.prototype.updateModel = function (modelId, model) {\n        var _this = this;\n        var updateMask = utils.generateUpdateMask(model);\n        return this.signUrlIfPresent(model)\n            .then(function (modelContent) { return _this.client.updateModel(modelId, modelContent, updateMask); })\n            .then(function (operation) { return _this.client.handleOperation(operation); })\n            .then(function (modelResponse) { return new Model(modelResponse, _this.client); });\n    };\n    /**\n     * Publishes a model in Firebase ML.\n     *\n     * @param {string} modelId The id of the model to publish.\n     *\n     * @return {Promise<Model>} A Promise fulfilled with the published model.\n     */\n    MachineLearning.prototype.publishModel = function (modelId) {\n        return this.setPublishStatus(modelId, true);\n    };\n    /**\n     * Unpublishes a model in Firebase ML.\n     *\n     * @param {string} modelId The id of the model to unpublish.\n     *\n     * @return {Promise<Model>} A Promise fulfilled with the unpublished model.\n     */\n    MachineLearning.prototype.unpublishModel = function (modelId) {\n        return this.setPublishStatus(modelId, false);\n    };\n    /**\n     * Gets a model from Firebase ML.\n     *\n     * @param {string} modelId The id of the model to get.\n     *\n     * @return {Promise<Model>} A Promise fulfilled with the unpublished model.\n     */\n    MachineLearning.prototype.getModel = function (modelId) {\n        var _this = this;\n        return this.client.getModel(modelId)\n            .then(function (modelResponse) { return new Model(modelResponse, _this.client); });\n    };\n    /**\n     * Lists models from Firebase ML.\n     *\n     * @param {ListModelsOptions} options The listing options.\n     *\n     * @return {Promise<{models: Model[], pageToken?: string}>} A promise that\n     *     resolves with the current (filtered) list of models and the next page\n     *     token. For the last page, an empty list of models and no page token are\n     *     returned.\n     */\n    MachineLearning.prototype.listModels = function (options) {\n        var _this = this;\n        if (options === void 0) { options = {}; }\n        return this.client.listModels(options)\n            .then(function (resp) {\n            if (!validator.isNonNullObject(resp)) {\n                throw new machine_learning_utils_1.FirebaseMachineLearningError('invalid-argument', \"Invalid ListModels response: \" + JSON.stringify(resp));\n            }\n            var models = [];\n            if (resp.models) {\n                models = resp.models.map(function (rs) { return new Model(rs, _this.client); });\n            }\n            var result = { models: models };\n            if (resp.nextPageToken) {\n                result.pageToken = resp.nextPageToken;\n            }\n            return result;\n        });\n    };\n    /**\n     * Deletes a model from Firebase ML.\n     *\n     * @param {string} modelId The id of the model to delete.\n     */\n    MachineLearning.prototype.deleteModel = function (modelId) {\n        return this.client.deleteModel(modelId);\n    };\n    MachineLearning.prototype.setPublishStatus = function (modelId, publish) {\n        var _this = this;\n        var updateMask = ['state.published'];\n        var options = { state: { published: publish } };\n        return this.client.updateModel(modelId, options, updateMask)\n            .then(function (operation) { return _this.client.handleOperation(operation); })\n            .then(function (modelResponse) { return new Model(modelResponse, _this.client); });\n    };\n    MachineLearning.prototype.signUrlIfPresent = function (options) {\n        var modelOptions = deep_copy_1.deepCopy(options);\n        if (machine_learning_api_client_1.isGcsTfliteModelOptions(modelOptions)) {\n            return this.signUrl(modelOptions.tfliteModel.gcsTfliteUri)\n                .then(function (uri) {\n                modelOptions.tfliteModel.gcsTfliteUri = uri;\n                return modelOptions;\n            })\n                .catch(function (err) {\n                throw new machine_learning_utils_1.FirebaseMachineLearningError('internal-error', \"Error during signing upload url: \" + err.message);\n            });\n        }\n        return Promise.resolve(modelOptions);\n    };\n    MachineLearning.prototype.signUrl = function (unsignedUrl) {\n        var MINUTES_IN_MILLIS = 60 * 1000;\n        var URL_VALID_DURATION = 10 * MINUTES_IN_MILLIS;\n        var gcsRegex = /^gs:\\/\\/([a-z0-9_.-]{3,63})\\/(.+)$/;\n        var matches = gcsRegex.exec(unsignedUrl);\n        if (!matches) {\n            throw new machine_learning_utils_1.FirebaseMachineLearningError('invalid-argument', \"Invalid unsigned url: \" + unsignedUrl);\n        }\n        var bucketName = matches[1];\n        var blobName = matches[2];\n        var bucket = this.appInternal.storage().bucket(bucketName);\n        var blob = bucket.file(blobName);\n        return blob.getSignedUrl({\n            action: 'read',\n            expires: Date.now() + URL_VALID_DURATION,\n        }).then(function (signUrl) { return signUrl[0]; });\n    };\n    return MachineLearning;\n}());\nexports.MachineLearning = MachineLearning;\n/**\n * A Firebase ML Model output object.\n */\nvar Model = /** @class */ (function () {\n    function Model(model, client) {\n        this.model = Model.validateAndClone(model);\n        this.client = client;\n    }\n    Object.defineProperty(Model.prototype, \"modelId\", {\n        get: function () {\n            return extractModelId(this.model.name);\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Model.prototype, \"displayName\", {\n        get: function () {\n            return this.model.displayName;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Model.prototype, \"tags\", {\n        get: function () {\n            return this.model.tags || [];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Model.prototype, \"createTime\", {\n        get: function () {\n            return new Date(this.model.createTime).toUTCString();\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Model.prototype, \"updateTime\", {\n        get: function () {\n            return new Date(this.model.updateTime).toUTCString();\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Model.prototype, \"validationError\", {\n        get: function () {\n            var _a, _b;\n            return (_b = (_a = this.model.state) === null || _a === void 0 ? void 0 : _a.validationError) === null || _b === void 0 ? void 0 : _b.message;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Model.prototype, \"published\", {\n        get: function () {\n            var _a;\n            return ((_a = this.model.state) === null || _a === void 0 ? void 0 : _a.published) || false;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Model.prototype, \"etag\", {\n        get: function () {\n            return this.model.etag;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Model.prototype, \"modelHash\", {\n        get: function () {\n            return this.model.modelHash;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Model.prototype, \"tfliteModel\", {\n        get: function () {\n            // Make a copy so people can't directly modify the private this.model object.\n            return deep_copy_1.deepCopy(this.model.tfliteModel);\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Model.prototype, \"locked\", {\n        /**\n         * Locked indicates if there are active long running operations on the model.\n         * Models may not be modified when they are locked.\n         */\n        get: function () {\n            var _a, _b;\n            return ((_b = (_a = this.model.activeOperations) === null || _a === void 0 ? void 0 : _a.length) !== null && _b !== void 0 ? _b : 0) > 0;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Model.prototype.toJSON = function () {\n        // We can't just return this.model because it has extra fields and\n        // different formats etc. So we build the expected model object.\n        var jsonModel = {\n            modelId: this.modelId,\n            displayName: this.displayName,\n            tags: this.tags,\n            createTime: this.createTime,\n            updateTime: this.updateTime,\n            published: this.published,\n            etag: this.etag,\n            locked: this.locked,\n        };\n        // Also add possibly undefined fields if they exist.\n        if (this.validationError) {\n            jsonModel['validationError'] = this.validationError;\n        }\n        if (this.modelHash) {\n            jsonModel['modelHash'] = this.modelHash;\n        }\n        if (this.tfliteModel) {\n            jsonModel['tfliteModel'] = this.tfliteModel;\n        }\n        return jsonModel;\n    };\n    /**\n     * Wait for the active operations on the model to complete.\n     * @param maxTimeMillis The number of milliseconds to wait for the model to be unlocked. If unspecified,\n     *     a default will be used.\n     */\n    Model.prototype.waitForUnlocked = function (maxTimeMillis) {\n        var _this = this;\n        var _a, _b;\n        if (((_b = (_a = this.model.activeOperations) === null || _a === void 0 ? void 0 : _a.length) !== null && _b !== void 0 ? _b : 0) > 0) {\n            // The client will always be defined on Models that have activeOperations\n            // because models with active operations came back from the server and\n            // were constructed with a non-empty client.\n            return this.client.handleOperation(this.model.activeOperations[0], { wait: true, maxTimeMillis: maxTimeMillis })\n                .then(function (modelResponse) {\n                _this.model = Model.validateAndClone(modelResponse);\n            });\n        }\n        return Promise.resolve();\n    };\n    Model.validateAndClone = function (model) {\n        if (!validator.isNonNullObject(model) ||\n            !validator.isNonEmptyString(model.name) ||\n            !validator.isNonEmptyString(model.createTime) ||\n            !validator.isNonEmptyString(model.updateTime) ||\n            !validator.isNonEmptyString(model.displayName) ||\n            !validator.isNonEmptyString(model.etag)) {\n            throw new machine_learning_utils_1.FirebaseMachineLearningError('invalid-server-response', \"Invalid Model response: \" + JSON.stringify(model));\n        }\n        var tmpModel = deep_copy_1.deepCopy(model);\n        // If tflite Model is specified, it must have a source consisting of\n        // oneof {gcsTfliteUri, automlModel}\n        if (model.tfliteModel &&\n            !validator.isNonEmptyString(model.tfliteModel.gcsTfliteUri) &&\n            !validator.isNonEmptyString(model.tfliteModel.automlModel)) {\n            // If we have some other source, ignore the whole tfliteModel.\n            delete tmpModel.tfliteModel;\n        }\n        // Remove '@type' field. We don't need it.\n        if (tmpModel[\"@type\"]) {\n            delete tmpModel[\"@type\"];\n        }\n        return tmpModel;\n    };\n    return Model;\n}());\nexports.Model = Model;\nfunction extractModelId(resourceName) {\n    return resourceName.split('/').pop();\n}\n"]},"metadata":{},"sourceType":"script"}